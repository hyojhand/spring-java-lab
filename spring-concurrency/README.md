## 동시성 문제 해결

- **Synchronized** : 단일 서버에서는 synchronized 로 동시성 해결


**서버가 여러대라면 데이터에 대한 정합성을 맞추기 위해 Lock 사용**

- **낙관적 락 (Optimistic Lock)** : Lock을 사용하지않고 Version을 사용해 어플리케이션 레벨에서 정합성을 관리한다.  
동시성 문제가 빈번하면 롤백 로직이 필요해 비효율적이다.

- **비관적 락 (Pessimistic Lock)** : 데이터에 lock을 걸어 정합성을 맞추는 방법으로 동시성 문제가 빈번하게 일어날 것이라고 예상하고 락을 건다. 모든 트랜잭션에 Lock을 사용하면서 (조회가 많이 일어날때) 성능상 문제가 될 수 있다.


**분산된 DB에서의 정합성을 맞추기 위해 분산 락을 사용한다.**

- **네임드 락 (Named Lock)** : 테이블이나 DB 객체가 아닌 사용자가 지정한 문자열(이름)에 락을 획득하고 반납한다.    
장점 : timeout 설정도 쉽게 가능하고 별도의 인프라 비용이 필요없다.  
단점 : 락을 획득,반납하는 과정에서 DB에 불필요한 부하가 생길 수 있고, 락과 비즈니스 로직의 트랜잭션을 분리할 필요가 있다.


- **Redis 활용 분산 락 (Distributed Lock)** : Redis라는 별도의 공간에 Lock을 관리, 인프라 구축 비용이 단점이다.

1. Lettuce - Setnx 명령어를 활용하여 분산락을 구현한다.  
Setnx는 Lock을 획득하려는 스레드가 Lock 획득 가능여부의 확인을 반복적으로 시도하는 스핀 락(Spin Lock) 방식이기 때문에 Redis에 많은 부하가 있다.


2. Redisson - Pub-sub 방식으로 Lock 을 구현한다.  
   Pub-Sub 방식이란 별도의 채널을 만들고, 락을 점유중인 스레드의 락이 해제될 때마다 대기중인 스레드에게 알림을 주어 대기중인 스레드가 락 점유를 시도하는 방식이다.

